# gophermart ‚Äî –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

- [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#abstract)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#arch)
  - [–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#arch-principle)
  - [–ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏](#arch-entities)
  - [–°—Ö–µ–º–∞ –ë–î](#arch-db)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#implement)
  - [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#implement-config)
  - [–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#implement-db)
  - [–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#implement-balance)
  - [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#implement-errors)
  - [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤](#implement-accrual)
  - [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#implement-deps)
- [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#extra)
  - [–ó–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –ø—Ä–æ–º–æ-–∫–æ–¥–∞–º](#extra-promo)
  - [–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–º—É —Å—á–µ—Ç—É](#extra-hist)
  - [–°—Ç–∞–± –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º](#extra-shop)
  - [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ](#extra-cluster)
- [–ò—Ç–æ–≥–∏ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å](#summary)
  - [–û—Å–≤–æ–µ–Ω–Ω—ã–µ —Ç–µ–º—ã](#summary-topics)
  - [–ó–∞–º–µ—á–∞–Ω–∏—è –∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏](#summary-remarks)
  - [–†–∞–∑–≤–∏—Ç–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#summary-further)

# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è <a name="abstract"/>

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è HTTP API –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ ¬´–ì–æ—Ñ–µ—Ä–º–∞—Ä—Ç¬ª: –ø–µ—Ä–≤—ã–π –≤—ã–ø—É—Å–∫–Ω–æ–π –ø—Ä–æ–µ–∫—Ç –∫—É—Ä—Å–∞  ¬´–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π Golang¬ª.

–ü–æ–º–∏–º–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è, –≤ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ó–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –ø—Ä–æ–º–æ-–∫–æ–¥–∞–º
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–º—É —Å—á–µ—Ç—É
- –°—Ç–∞–± –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º: [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#extra)


# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ <a name="arch"/>

## –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è <a name="arch-principle"/>
![–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](docs/arch-principle.png)

## –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ <a name="arch-entities"/>
![–ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏](docs/arch-entities.png)

## –°—Ö–µ–º–∞ –ë–î <a name="arch-db"/>
![–°—Ö–µ–º–∞ –ë–î](docs/arch-db.png)

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º [internal/repo/migrations/01_initial.sql](internal/repo/migrations/01_initial.sql)

# –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ <a name="implement"/>

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è <a name="implement-config"/>

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Ñ–ª–∞–≥–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è | –§–ª–∞–≥ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- | --- |
| `DATABASE_URI` | `-d <dsn>` | –∞–¥—Ä–µ—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö |
| `RUN_ADDRESS`| `-a <host:port>` | –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ |
| `AUTH_SECRET` | _–Ω–µ—Ç_ | –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞ |
| `AUTH_TTL` | `-t <duration>` | –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ |
| `ACCRUAL_SYSTEM_ADDRESS` | `-r <url>` | –∞–¥—Ä–µ—Å —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á—ë—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π |
| `ACCRUAL_SYSTEM_TIMEOUT` | `-m <duration>` | —Ç–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å—á—ë—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π |
| `ACCRUAL_SYSTEM_POLL_INTERVAL` | `-p <duration>` | –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á—ë—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π |

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö <a name="implement-db"/>
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –¥–∞–Ω–Ω—ã–º–∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –≤–∏–¥–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π SQL (SQL Constraints). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º [internal/repo/errors.go](internal/repo/errors.go)

## –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è <a name="implement-balance"/>
–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –æ–±—â–∞—è —Å—É–º–º–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –Ω–∞ —Å—á–µ—Ç–µ –∏ –∫–æ–ª-–≤–æ —Å–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ª—é–±–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ <a name="implement-errors"/>
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ —Å–Ω–∞—á–∞–ª–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏. –ü—Ä–∏ —ç—Ç–æ–º –≤ –≤—ã—à–µ—Å—Ç–æ—è—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–µ –∏—Å—Ö–æ–¥–Ω–∞—è –æ—à–∏–±–∫–∞, –∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –µ–π –æ—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `errs.Error`.

```golang
type Error struct {
	error
	Code     int
	HTTPCode int
}
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ HTTP-–∑–∞–ø—Ä–æ—Å–∞, —Ç–æ –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —Ç–∞–∫–∂–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è `request_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑–≤–∞–ª –æ—à–∏–±–∫—É, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –≤ –∫–∞–∫–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞.

–ü—Ä–∏ —ç—Ç–æ–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ—à–∏–±–∫–µ HTTP-–∫–æ–¥ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –æ—à–∏–±–∫–∏ –≤ JSON.

```
HTTP/1.1 409 Conflict
Content-Type: application/json

{
   "code": 1204,
   "message": "Order number belongs to another user",
   "request_id": "<request id>"
}
```


### –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (1000-1099)
| –û—à–∏–±–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ë–î | –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP-–∫–æ–¥ |
| --- | --- | --- | --- | --- |
| **ErrInternal** | –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ | - | 1000 | 500 |
| **ErrNotFound** | –Ω–µ –Ω–∞–π–¥–µ–Ω–æ | - | 1001 | 404 |
| **ErrUnauthorized** | –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω | - | 1002 | 401 |
| **ErrBadRequest** | –Ω–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å | - | 1003 | 400 |


### –û—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (1100-1199)
| –û—à–∏–±–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ë–î | –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP-–∫–æ–¥ |
| --- | --- | --- | --- | --- |
| **ErrUserAlreadyExists** | –ª–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º | `username_unique` | 1100 | 409 |
| **ErrUserLoginInvalid** | –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ª–æ–≥–∏–Ω | - | 1101 | 400 |
| **ErrUserPassInvalid** | –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–∞—Ä–æ–ª—å | - | 1102 | 400 |
| **ErrUserLoginPassMismatch** | –Ω–µ–≤–µ—Ä–Ω–∞—è –ø–∞—Ä–∞ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å | ‚Äì | 1103 | 401 |
| **ErrUserBalanceNegative** | –æ–±—â–∞—è —Å—É–º–º–∞ –Ω–∞ —Å—á–µ—Ç–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π | `balance_not_negative` | 1105 | 402 |
| **ErrUserWithdrawnNegative** | –æ–±—â–∞—è —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π | `withdrawn_not_negative` | 1106 | 500 |

### –û—à–∏–±–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π (1200-1299)

| –û—à–∏–±–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ë–î | –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP-–∫–æ–¥ |
| --- | --- | --- | --- | --- |
| **ErrOperationAttrsInvalid** | –∞—Ç—Ç—Ä–∏–±—É—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏ | `operation_valid_attrs` | 1200 | 500 |
| **ErrOperationAmountInvalid** | –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ —Å–ø–∏—Å–∞–Ω–∏—è - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ | `amount_valid_sign` | 1201 | 400 |
| **ErrOperationUserNotExists** | –æ–ø–µ—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `must_refs_user` | 1202 | 400 |
| ErrOperationOrderNumberInvalid | –Ω–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ | ‚Äì | 1203 | 422 |
| **ErrOperationOrderNotBelongs** | –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | `order_belongs_to_user` | 1204 | 409 |
| **ErrOperationOrderUsed** | –ø–æ –∑–∞–∫–∞–∑—É –≤–æ–∑–º–æ–∂–Ω–∞ 1 –æ–ø–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ –∏ 1 –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ | `order_unique_for_op_type` | 1205 | 409 |
| **ErrOperationPromoUsed** | –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–µ–π –Ω–µ –±–æ–ª–µ–µ 1 —Ä–∞–∑–∞ | `promo_unique_for_user` | 1206 | 409 |

### –û—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–π (1300-1399)
–≠—Ç–∏ –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è —Ö–µ–Ω–¥–ª–µ—Ä–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–π. –í –¥–∞–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö–µ–Ω–¥–ª–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–π –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–π —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏).

| –û—à–∏–±–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ë–î | –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP-–∫–æ–¥ |
| --- | --- | --- | --- | --- |
| **ErrPromoAlreadyExists** | –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ | `promo_code_unique` | 1300 | 409 |
| **ErrPromoRewardNotPositive** | –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∑–∞ –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º | `promo_reward_positive` | 1301 | 400 |
| **ErrPromoPeriodInvalid** | –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–µ–Ω—å—à–µ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è | `promo_valid_period` | 1302 | 400 |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (1400-1499)
| –û—à–∏–±–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ë–î | –ö–æ–¥ –æ—à–∏–±–∫–∏ | HTTP-–∫–æ–¥ |
| --- | --- | --- | --- | --- |
| **ErrIntegrationTooManyRequests** | —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É | ‚Äì | 1400 | 429 |
| **ErrIntegrationRequestFailed** | –æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–Ω–µ—à–Ω–µ–º–º—É —Å–µ—Ä–≤–∏—Å—É | ‚Äì | 1401 | 500 |

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ <a name="implement-accrual"/>

–ê–ª–≥–æ—Ä–∏—Ç–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. –í –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–∞ `‚Äåorder_accrual` –≤ –Ω–µ-—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ –∏ —Å —Å–∞–º—ã–º —Å—Ç–∞—Ä—ã–º –ø–æ–ª–µ–º `updated_at`,
2. –î–ª—è —ç—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞ –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –≤ —Å–∏—Å—Ç–µ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
3. –û–ø–µ—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤

–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ –æ–ø—Ä–æ—Å–∞ –∑–∞–¥–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ –≤–µ—Ä–Ω—É–ª–∞ `429 Too many requests`, —Ç–æ –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –æ–ø—Ä–æ—Å–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ <a name="implement-deps"/>
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: [caarlos0/env](https://github.com/caarlos0/env)
- –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: [rs/zerolog](https://github.com/rs/zerolog)
- –†–∞–±–æ—Ç–∞ —Å –ë–î: [jackc/pgx](https://github.com/jackc/pgx), [pressly/goose](https://github.com/pressly/goose)
- –ß–∏—Å–ª–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–ø—è—Ç–æ–π: [shopspring/decimal](https://github.com/shopspring/decimal)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: [golang-jwt/jwt](https://github.com/golang-jwt/jwt)
- –†–∞–±–æ—Ç–∞ —Å HTTP: [go-chi/chi](https://github.com/go-chi/chi), [go-chi/render](https://github.com/go-chi/render)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: [stretchr/testify](https://github.com/stretchr/testify), [vektra/mockery](https://github.com/vektra/mockery)

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å <a name="extra"/>

## –ó–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –ø—Ä–æ–º–æ-–∫–æ–¥–∞–º <a name="extra-promo"/>
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—É—â–Ω–æ—Å—Ç—å **¬´–ü—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏—è¬ª**:
- –ü—Ä–æ–º–æ-–∫–æ–¥ –∫–∞–º–ø–∞–Ω–∏–∏ (—É–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞–º–ø–∞–Ω–∏–∏)
- –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –∫–∞–º–ø–∞–Ω–∏–∏: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª-–≤–æ –±–∞–ª–ª–æ–≤
- –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
- –î–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–º–ø–∞–Ω–∏–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–æ–Ω—É—Å–Ω—ã–π —Å—á–µ—Ç, –≤–≤–µ–¥—è –ø—Ä–æ–º–æ-–∫–æ–¥ –∫–∞–º–ø–∞–Ω–∏–∏.

–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
```
POST /api/user/promos HTTP/1.1
Content-Type: text/plain

WELCOME2020
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:
- `200` ‚Äî —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
- `400` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- `404` ‚Äî –ø—Ä–æ–º–æ-–∫–æ–º–ø–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å –∏–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å)
- `409` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–æ–º–æ-–∫–∞–º–ø–∞–Ω–∏–µ–π –Ω–µ –±–æ–ª–µ–µ 1 —Ä–∞–∑–∞
- `500` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º—É –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è 2 –∫–∞–º–ø–∞–Ω–∏–∏:
- `‚ÄåWELCOME-GOPHER` ‚Äî –¥–µ–π—Å—Ç–≤—É—é—â–∞—è, 20 –±–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- `GOLANG-2021` ‚Äî –∏—Å—Ç–µ–∫—à–∞—è

## –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–º—É —Å—á–µ—Ç—É <a name="extra-hist"/>
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –±–æ–Ω—É—Å–Ω–æ–º—É —Å—á–µ—Ç—É. –ò—Å—Ç–æ—Ä–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–ª–∞–Ω—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –≤ —Å—Ç–∞—Ç—É—Å–µ `PROCESSED`
- –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∞–Ω–∏—è –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö `NEW`, `PROCESSING`, `PROCESSED`

–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:
```
GET /api/user/balance/history HTTP/1.1
Content-Length: 0
Authorization: Bearer <token>
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:
- `200` ‚Äî —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
- `204` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø—É—Å—Ç–∞
- `401` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `500` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
```
HTTP/1.1 200 OK
Content-Type: application/json

[
   {
     "amount": -300,
     "number": "12345678903",
     "description": "–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑ 12345678903",
     "processed_at": "2020-01-03T00:00:00Z"
   },
   {
     "amount": 500.5,
     "number": "9278923470",
     "description": "–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ –∑–∞–∫–∞–∑ 9278923470",
     "processed_at": "2020-01-02T00:00:00Z"
   },
   {
     "amount": 100,
     "description": "–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –ø–æ –ø—Ä–æ–º–æ-–∫–æ–¥—É WELCOME2020",
     "processed_at": "2020-01-01T00:00:00Z"
   }
]
```

## –°—Ç–∞–± –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º <a name="extra-shop"/>
–í –∫–∞—á–µ—Å—Ç–≤–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —ç–º—É–ª—è—Ç–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞–≥–∞–∑–∏–Ω–æ–º –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–∫—É–ø–æ–∫ –±–æ–Ω—É—Å–Ω—ã–º–∏ –±–∞–ª–ª–∞–º–∏.

–≠–º—É–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ `‚Äåorder_withdrawal` –≤ –∫–æ–Ω–µ—á–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–ø—É—Å—Ç—è 1 –º–∏–Ω—É—Ç—É –ø–æ—Å–ª–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è.

–ü—Ä–∏ —ç—Ç–æ–º, –æ–ø–µ—Ä—Ü–∏–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ –∑–∞–∫–∞–∑–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–º–∏—Å—è —Å `000`, –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å `CANCELED` (–∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω). –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ —Å–ø–∏—Å–∞–Ω–∏—é –±–∞–ª–ª–æ–≤ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å `PROCESSED`.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ <a name="extra-cluster"/>
–¢–∫ –≤—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

![–ü—Ä–∏–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞](docs/extra-cluster.png)

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å–º: [docker/cluster-demo/docker-compose.yaml](docker/cluster-demo/docker-compose.yaml)

# –ò—Ç–æ–≥–∏ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å <a name="summary"/>

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ [The twelve-factor app](https://12factor.net).

–í –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –∑–∞–¥–µ–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –±–æ–Ω—É—Å–Ω–æ–º—É —Å—á–µ—Ç—É. –ù–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–≥–æ—Ä–∞–Ω–∏–µ¬ª –±–æ–Ω—É—Å–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º.

## –û—Å–≤–æ–µ–Ω–Ω—ã–µ —Ç–µ–º—ã <a name="summary-topics"/>
| –¢–µ–º–∞ | –í—Ä–µ–º—è | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
| --- | --- | --- | --- |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–ó | üïìüïì | üëçüëç |  |
| SQL / Postgres | üïìüïìüïì | üëçüëçüëç | –ó–∞–∫—Ä—ã–ª –º–Ω–æ–≥–æ –ø—Ä–æ–±–µ–ª–æ–≤ –ø–æ SQL. –û–∑–Ω–∞–∫–æ–º–∏–ª—Å—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ Postgres. –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —Å—Ö–µ–º –ë–î –∏ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö |
| –Ø–∑—ã–∫ Go | üïì | üëç | –ù–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —è–∑—ã–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–ª |
| –ù–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ | üïì | üëçüëç | –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª 2 –Ω–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ 2 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è SQL-–º–∏–≥—Ä–∞—Ü–∏–π |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | üïìüïì | üëçüëç | –ü—Ä–æ—Ä–∞–±–æ—Ç–∞–ª –ø–æ–¥—Ö–æ–¥ –∫ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –æ—à–∏–±–æ–∫ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | üïì | üëç | –ü—Ä–∏–º–µ–Ω–∏–ª —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–º–µ–Ω—è–ª —Ä–∞–Ω–µ–µ –¥–ª—è —Å–æ–∫—Ä–∞—â–∞–ª–∫–∏ —Å—Å—ã–ª–æ–∫ |
| Code- style –∏ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | üïìüïìüïì | üëç | –ü–æ—Ç—Ä–∞—Ç–∏–ª –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ- –∫–æ–ª-–≤–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞. –°—á–∏—Ç–∞—é, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | üïìüïì | üëçüëçüëç | –û—Å–≤–æ–∏–ª –º–æ–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω |
| DI | ‚Äì | ‚Äì | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–ª –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ DI-—Ä–µ—à–µ–Ω–∏—è —Ç–∏–ø–∞ uber/dig –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö, –Ω–æ –Ω–µ —É—Å–ø–µ–ª. –ü–æ—Å—Ç–∞—Ä–∞–ª—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DI –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ. |


## –ó–∞–º–µ—á–∞–Ω–∏—è –∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ <a name="summary-remarks"/>

### –ó–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –≤ –æ—Ç–≤–µ—Ç–µ
–í –¢–ó –Ω–µ –æ–ø–∏—Å–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ê –≤ –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞—Ö –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —á—Ç–æ —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –ª–∏–±–æ –≤ –∫—É–∫–µ –ª–∏–±–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –æ—Ç–≤–µ—Ç–∞ `Authorization`.

–ü—Ä–∏ —ç—Ç–æ–º –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization` –≤ HTTP-–æ—Ç–≤–µ—Ç–µ ‚Äî —ç—Ç–æ **–Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**, –Ω–µ –æ–ø–∏—Å–∞–Ω–Ω–∞—è –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ HTTP –∏–ª–∏ –≤ –∫–∞–∫–æ–º-–ª–∏–±–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ó–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ HTTP-–∑–∞–ø—Ä–æ—Å–∞—Ö –Ω–æ –Ω–µ –≤ –æ—Ç–≤–µ—Ç–∞—Ö.

## –†–∞–∑–≤–∏—Ç–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ <a name="summary-further"/>

–í —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ –ø–æ–¥–æ–±–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Å–∏—Å—Ç–µ–º—ã  ‚Äî –≤–µ–¥–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤, –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥, —É—á–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ ‚Äî —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
- –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –∞—É–¥–∏—Ç
- —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö
- –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ process-minig
- –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- –∏ –¥—Ä

–í —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π –º–æ–≥ –±—ã –±—ã—Ç—å event-driven –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–æ—Å—Ç–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–±—ã—Ç–∏–π –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

---
¬© Oleg Fomin 2022, ofstudio@gmail.com
